<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Knee OA Grading System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'medical-blue': '#1e40af',
            'medical-light': '#dbeafe'
          }
        }
      }
    }
  </script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .glass-effect {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .upload-zone {
      transition: all 0.3s ease;
    }
    .upload-zone:hover {
      transform: scale(1.02);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    .result-card {
      animation: slideIn 0.5s ease-out;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #3498db;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

  <!-- Navbar -->
  <nav class="fixed top-0 left-0 w-full bg-white/80 backdrop-blur-md shadow-lg z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
          <span class="text-white font-bold text-sm">ðŸ¦´</span>
        </div>
        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
          Knee OA Grading
        </h1>
      </div>
      <ul class="flex space-x-8">
        <li><a href="#home" class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-300">Home</a></li>
        <li><a href="#analyzer" class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-300">Analyzer</a></li>
        <li><a href="#about" class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-300">About</a></li>
        <li><a href="#grades" class="text-gray-700 hover:text-blue-600 font-medium transition-colors duration-300">Grades</a></li>
      </ul>
    </div>
  </nav>

  <!-- Home Section -->
  <section id="home" class="min-h-screen flex flex-col justify-center items-center text-center pt-20 px-6">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-5xl md:text-6xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-6">
        Advanced Knee OA Classification
      </h2>
      <p class="text-xl md:text-2xl text-gray-600 max-w-3xl mx-auto mb-8 leading-relaxed">
        Harness the power of AI to accurately classify Osteoarthritis severity in knee X-rays using the Kellgren-Lawrence grading system.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="#analyzer" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-full font-semibold text-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
          Start Analysis
        </a>
        <a href="#about" class="border-2 border-blue-600 text-blue-600 px-8 py-4 rounded-full font-semibold text-lg hover:bg-blue-600 hover:text-white transition-all duration-300">
          Learn More
        </a>
      </div>
    </div>
  </section>

  <!-- Image Analyzer Section -->
  <section id="analyzer" class="min-h-screen bg-white py-20 px-6">
    <div class="max-w-6xl mx-auto">
      <h2 class="text-4xl font-bold text-center bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-12">
        X-Ray Image Analyzer
      </h2>
      
      <!-- Upload Section -->
      <div class="mb-12">
        <div class="upload-zone bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-dashed border-blue-300 rounded-2xl p-12 text-center cursor-pointer hover:border-blue-500">
          <input type="file" id="imageInput" accept="image/*" class="hidden" />
          <div id="uploadContent">
            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">Upload Knee X-Ray Image</h3>
            <p class="text-gray-500 mb-4">Click to browse or drag and drop your X-ray image</p>
            <p class="text-sm text-gray-400">Supported formats: JPG, PNG, JPEG (Max: 16MB)</p>
          </div>
          <div id="loadingContent" class="hidden">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-blue-600 font-semibold">Analyzing image...</p>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="hidden">
        <div class="grid md:grid-cols-2 gap-8 mb-8">
          <!-- Original Image -->
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Original X-Ray</h3>
            <div class="bg-gray-50 rounded-xl p-4">
              <img id="originalImage" class="w-full h-auto rounded-lg" />
            </div>
          </div>

          <!-- Grad-CAM Visualization -->
          <div class="bg-white rounded-2xl shadow-lg p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">AI Attention Map</h3>
            <div class="bg-gray-50 rounded-xl p-4">
              <img id="gradcamImage" class="w-full h-auto rounded-lg" />
            </div>
          </div>
        </div>

        <!-- Analysis Results -->
        <div class="result-card bg-white rounded-2xl shadow-lg p-8">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">Analysis Results</h3>
          
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Classification Result -->
            <div>
              <div class="flex items-center mb-4">
                <span id="resultIcon" class="text-3xl mr-3">ðŸŸ¢</span>
                <div>
                  <h4 id="resultGrade" class="text-xl font-bold text-gray-800">Normal (KL Grade 0)</h4>
                  <div class="flex items-center">
                    <span class="text-sm text-gray-600 mr-2">Confidence:</span>
                    <div class="bg-gray-200 rounded-full h-2 w-24 mr-2">
                      <div id="confidenceBar" class="bg-green-500 h-2 rounded-full transition-all duration-500"></div>
                    </div>
                    <span id="confidenceText" class="text-sm font-semibold text-gray-700">95%</span>
                  </div>
                </div>
              </div>

              <div class="space-y-4">
                <div class="bg-blue-50 rounded-lg p-4">
                  <h5 class="font-semibold text-blue-800 mb-2">Description</h5>
                  <p id="resultDescription" class="text-blue-700">No signs of osteoarthritis...</p>
                </div>

                <div class="bg-yellow-50 rounded-lg p-4">
                  <h5 class="font-semibold text-yellow-800 mb-2">Symptoms</h5>
                  <p id="resultSymptoms" class="text-yellow-700">No symptoms...</p>
                </div>
              </div>
            </div>

            <!-- Treatment and Risk -->
            <div class="space-y-4">
              <div class="bg-green-50 rounded-lg p-4">
                <h5 class="font-semibold text-green-800 mb-2">Treatment Recommendations</h5>
                <p id="resultTreatment" class="text-green-700">Maintain healthy lifestyle...</p>
              </div>

              <div class="bg-red-50 rounded-lg p-4">
                <h5 class="font-semibold text-red-800 mb-2">Risk Assessment</h5>
                <p id="resultRisk" class="text-red-700">Low risk...</p>
              </div>

              <div class="bg-gray-50 rounded-lg p-4">
                <h5 class="font-semibold text-gray-800 mb-2">Processing Info</h5>
                <p class="text-gray-700">
                  <span class="font-medium">Analysis Time:</span> <span id="processingTime">0.0s</span>
                </p>
              </div>
            </div>
          </div>

          <!-- Confidence Distribution -->
          <div class="mt-8">
            <h5 class="font-semibold text-gray-800 mb-4">Grade Distribution</h5>
            <div class="space-y-2" id="distributionBars">
              <!-- Dynamically generated bars -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="bg-gradient-to-br from-blue-900 to-purple-900 text-white py-20 px-6">
    <div class="max-w-5xl mx-auto">
      <h2 class="text-4xl font-bold mb-8 text-center">About the Project</h2>
      <div class="grid md:grid-cols-2 gap-12">
        <div>
          <h3 class="text-2xl font-semibold mb-4">What is Knee OA?</h3>
          <p class="text-blue-100 mb-6 leading-relaxed">
            Knee osteoarthritis (OA) is a degenerative joint disease characterized by the breakdown of cartilage in the knee joint. This leads to pain, stiffness, and reduced mobility, significantly impacting quality of life.
          </p>
          <p class="text-blue-100 leading-relaxed">
            Early detection and accurate grading are crucial for effective treatment planning and disease management.
          </p>
        </div>
        <div>
          <h3 class="text-2xl font-semibold mb-4">Our AI Solution</h3>
          <p class="text-blue-100 mb-6 leading-relaxed">
            Our advanced deep learning model uses Inception-ResNet-v2 architecture to analyze knee X-ray images and classify OA severity according to the Kellgren-Lawrence grading system.
          </p>
          <ul class="text-blue-100 space-y-2">
            <li>â€¢ High accuracy classification</li>
            <li>â€¢ Grad-CAM visualization for interpretability</li>
            <li>â€¢ Real-time analysis and results</li>
            <li>â€¢ Clinical-grade reliability</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Grades Section -->
  <section id="grades" class="bg-white py-20 px-6">
    <div class="max-w-6xl mx-auto">
      <h2 class="text-4xl font-bold text-center bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-12">
        Kellgren-Lawrence Grading Scale
      </h2>
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Grade 0 -->
        <div class="bg-gradient-to-br from-green-50 to-green-100 border-l-4 border-green-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300">
          <div class="flex items-center mb-4">
            <span class="text-2xl mr-3"></span>
            <h3 class="text-xl font-bold text-green-800">Grade 0 - Normal</h3>
          </div>
          <p class="text-green-700 mb-3">No signs of osteoarthritis. Healthy knee joint with normal joint space.</p>
          <div class="text-sm text-green-600">
            <strong>Risk:</strong> Low
          </div>
        </div>

        <!-- Grade 1 -->
        <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 border-l-4 border-yellow-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300">
          <div class="flex items-center mb-4">
            <span class="text-2xl mr-3"></span>
            <h3 class="text-xl font-bold text-yellow-800">Grade 1 - Doubtful</h3>
          </div>
          <p class="text-yellow-700 mb-3">Possible minimal osteophytes, uncertain joint space narrowing.</p>
          <div class="text-sm text-yellow-600">
            <strong>Risk:</strong> Moderate
          </div>
        </div>

        <!-- Grade 2 -->
        <div class="bg-gradient-to-br from-orange-50 to-orange-100 border-l-4 border-orange-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300">
          <div class="flex items-center mb-4">
            <span class="text-2xl mr-3"></span>
            <h3 class="text-xl font-bold text-orange-800">Grade 2 - Mild</h3>
          </div>
          <p class="text-orange-700 mb-3">Definite osteophytes, possible joint space narrowing.</p>
          <div class="text-sm text-orange-600">
            <strong>Risk:</strong> High
          </div>
        </div>

        <!-- Grade 3 -->
        <div class="bg-gradient-to-br from-red-50 to-red-100 border-l-4 border-red-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300">
          <div class="flex items-center mb-4">
            <span class="text-2xl mr-3"></span>
            <h3 class="text-xl font-bold text-red-800">Grade 3 - Moderate</h3>
          </div>
          <p class="text-red-700 mb-3">Multiple osteophytes, definite joint space narrowing.</p>
          <div class="text-sm text-red-600">
            <strong>Risk:</strong> Very High
          </div>
        </div>

        <!-- Grade 4 -->
        <div class="bg-gradient-to-br from-purple-50 to-purple-100 border-l-4 border-purple-500 rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300">
          <div class="flex items-center mb-4">
            <span class="text-2xl mr-3"></span>
            <h3 class="text-xl font-bold text-purple-800">Grade 4 - Severe</h3>
          </div>
          <p class="text-purple-700 mb-3">Large osteophytes, severe narrowing, major deformity.</p>
          <div class="text-sm text-purple-600">
            <strong>Risk:</strong> Critical
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12 px-6">
    <div class="max-w-4xl mx-auto text-center">
      <h3 class="text-2xl font-bold mb-4">Knee OA Grading System</h3>
      <p class="text-gray-400 mb-6">Advanced AI-powered osteoarthritis classification for medical professionals</p>
      <div class="border-t border-gray-700 pt-6">
        <p class="text-gray-500 text-sm">
          Â© 2025 Knee OA Grading System. This tool is for research and educational purposes only. 
          Always consult with healthcare professionals for medical diagnosis and treatment.
        </p>
      </div>
    </div>
  </footer>

  <script>
    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });

    // Image upload and analysis
    const imageInput = document.getElementById('imageInput');
    const uploadZone = document.querySelector('.upload-zone');
    const uploadContent = document.getElementById('uploadContent');
    const loadingContent = document.getElementById('loadingContent');
    const resultsSection = document.getElementById('resultsSection');

    // Click to upload
    uploadZone.addEventListener('click', () => imageInput.click());

    // Drag and drop functionality
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('border-blue-500', 'bg-blue-100');
    });

    uploadZone.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('border-blue-500', 'bg-blue-100');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('border-blue-500', 'bg-blue-100');
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        handleImageUpload(files[0]);
      }
    });

    // File input change
    imageInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        handleImageUpload(e.target.files[0]);
      }
    });

    // Handle image upload and analysis
    function handleImageUpload(file) {
      if (!file.type.startsWith('image/')) {
        alert('Please select a valid image file.');
        return;
      }

      // Show loading
      uploadContent.classList.add('hidden');
      loadingContent.classList.remove('hidden');
      resultsSection.classList.add('hidden');

      // Create FormData
      const formData = new FormData();
      formData.append('image', file);

      // Send to Flask backend
      fetch('/analyze', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          displayResults(data);
        } else {
          alert('Error analyzing image: ' + data.error);
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error analyzing image. Please try again.');
      })
      .finally(() => {
        // Hide loading
        uploadContent.classList.remove('hidden');
        loadingContent.classList.add('hidden');
      });
    }

    // Display analysis results
    function displayResults(data) {
      // Update images
      document.getElementById('originalImage').src = data.original_image;
      document.getElementById('gradcamImage').src = data.gradcam_image;

      // Update result information
      document.getElementById('resultIcon').textContent = data.icon;
      document.getElementById('resultGrade').textContent = data.class_name;
      document.getElementById('resultDescription').textContent = data.description;
      document.getElementById('resultSymptoms').textContent = data.symptoms;
      document.getElementById('resultTreatment').textContent = data.treatment;
      document.getElementById('resultRisk').textContent = data.risk;
      document.getElementById('processingTime').textContent = data.processing_time + 's';

      // Update confidence
      const confidence = Math.round(data.confidence * 100);
      document.getElementById('confidenceText').textContent = confidence + '%';
      document.getElementById('confidenceBar').style.width = confidence + '%';
      
      // Color code confidence bar
      if (confidence >= 80) {
        document.getElementById('confidenceBar').className = 'bg-green-500 h-2 rounded-full transition-all duration-500';
      } else if (confidence >= 60) {
        document.getElementById('confidenceBar').className = 'bg-yellow-500 h-2 rounded-full transition-all duration-500';
      } else {
        document.getElementById('confidenceBar').className = 'bg-red-500 h-2 rounded-full transition-all duration-500';
      }

      // Update distribution bars
      const distributionContainer = document.getElementById('distributionBars');
      distributionContainer.innerHTML = '';
      
      const gradeNames = ['Normal', 'Doubtful', 'Mild', 'Moderate', 'Severe'];
      const gradeColors = ['green', 'yellow', 'orange', 'red', 'purple'];
      
      data.confidence_distribution.forEach((prob, index) => {
        const percentage = Math.round(prob * 100);
        const barDiv = document.createElement('div');
        barDiv.className = 'flex items-center';
        barDiv.innerHTML = `
          <div class="w-20 text-sm font-medium text-gray-700">${gradeNames[index]}:</div>
          <div class="flex-1 bg-gray-200 rounded-full h-2 mx-3">
            <div class="bg-${gradeColors[index]}-500 h-2 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
          </div>
          <div class="w-12 text-sm text-gray-600">${percentage}%</div>
        `;
        distributionContainer.appendChild(barDiv);
      });

      // Show results
      resultsSection.classList.remove('hidden');
      
      // Scroll to results
      setTimeout(() => {
        resultsSection.scrollIntoView({ behavior: 'smooth' });
      }, 100);
    }

    // Add some interactive elements
    document.addEventListener('DOMContentLoaded', function() {
      // Add hover effects to grade cards
      const gradeCards = document.querySelectorAll('#grades .shadow-lg');
      gradeCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0) scale(1)';
        });
      });
    });
  </script>
</body>
</html>